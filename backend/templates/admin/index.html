{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    lucide.createIcons();
});
</script>
<style>
.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.stat-card h3 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.stat-card .number {
    font-size: 2.5em;
    font-weight: bold;
    color: #2c3e50;
    margin: 10px 0;
}

.stat-card .subtitle {
    color: #666;
    font-size: 12px;
}

.recent-activity {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.activity-section {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.activity-section h3 {
    margin: 0 0 15px 0;
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 10px;
}

.activity-item {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-item .title {
    font-weight: bold;
    color: #333;
}

.activity-item .meta {
    color: #666;
    font-size: 12px;
    margin-top: 5px;
}

.amount {
    color: #28a745;
    font-weight: bold;
}

.status-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
}

.status-completed { background: #d4edda; color: #155724; }
.status-pending { background: #fff3cd; color: #856404; }
.status-active { background: #d1ecf1; color: #0c5460; }
.status-ongoing { background: #d1ecf1; color: #0c5460; }
.status-approved { background: #d4edda; color: #155724; }
.status-rejected { background: #f8d7da; color: #721c24; }
.status-under_review { background: #fff3cd; color: #856404; }

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
    color: white;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.dashboard-header h1 {
    margin: 0;
    font-size: 2em;
    font-weight: 600;
}

.dashboard-actions {
    display: flex;
    gap: 15px;
}

.btn {
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: #27ae60;
    color: white;
}

.btn-primary:hover {
    background: #229954;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    color: white;
}

.btn-secondary {
    background: rgba(255,255,255,0.2);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
}

.btn-secondary:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-2px);
    color: white;
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1><i data-lucide="target"></i> CauseHive Admin Dashboard</h1>
    <div class="dashboard-actions">
        <a href="{% url 'admin_dashboard' %}" class="btn btn-primary">
            <i data-lucide="bar-chart-3"></i> Enhanced Dashboard
        </a>
        <a href="{% url 'admin:causes_causes_add' %}" class="btn btn-secondary">
            <i data-lucide="plus"></i> Add Cause
        </a>
    </div>
</div>

<div class="dashboard-stats">
    <a href="{% url 'admin:users_n_auth_user_changelist' %}" class="stat-card">
        <h3>Total Users</h3>
        <div class="number">{{ total_users }}</div>
        <div class="subtitle">{{ active_users }} active</div>
    </a>
    
    <a href="{% url 'admin:users_n_auth_user_changelist' %}?date_joined__gte={{ today|date:'Y-m-d' }}" class="stat-card">
        <h3>New Users Today</h3>
        <div class="number">{{ new_users_today }}</div>
        <div class="subtitle">{{ new_users_this_week }} this week</div>
    </a>
    
    <a href="{% url 'admin:causes_causes_changelist' %}" class="stat-card">
        <h3>Total Causes</h3>
        <div class="number">{{ total_causes }}</div>
        <div class="subtitle">{{ active_causes }} active</div>
    </a>
    
    <a href="{% url 'admin:causes_causes_changelist' %}?status=under_review" class="stat-card">
        <h3>Pending Causes</h3>
        <div class="number">{{ pending_causes }}</div>
        <div class="subtitle">{{ approved_causes }} approved</div>
    </a>
    
    <a href="{% url 'admin:donations_donation_changelist' %}" class="stat-card">
        <h3>Total Donations</h3>
        <div class="number">{{ completed_donations }}</div>
        <div class="subtitle">GHS {{ total_donated_amount|floatformat:0 }} raised</div>
    </a>
    
    <a href="{% url 'admin:cart_cart_changelist' %}" class="stat-card">
        <h3>Active Carts</h3>
        <div class="number">{{ active_carts }}</div>
        <div class="subtitle">{{ completed_carts }} completed</div>
    </a>
    
    <a href="{% url 'admin:payments_paymenttransaction_changelist' %}" class="stat-card">
        <h3>Payments</h3>
        <div class="number">{{ completed_payments }}</div>
        <div class="subtitle">{{ pending_payments }} pending</div>
    </a>
</div>

<div class="recent-activity">
    <div class="activity-section">
        <h3>Recent Donations</h3>
        {% for donation in recent_donations %}
        <div class="activity-item">
            <div class="title">
                {{ donation.user_id.email|default:"Anonymous" }} donated 
                <span class="amount">GHS {{ donation.amount }}</span>
            </div>
            <div class="meta">
                to {{ donation.cause_id.name }} • {{ donation.donated_at|timesince }} ago
                <span class="status-badge status-{{ donation.status }}">{{ donation.status }}</span>
            </div>
        </div>
        {% empty %}
        <p>No recent donations</p>
        {% endfor %}
    </div>
    
    <div class="activity-section">
        <h3>Recent Causes</h3>
        {% for cause in recent_causes %}
        <div class="activity-item">
            <div class="title">{{ cause.name }}</div>
            <div class="meta">
                by {{ cause.organizer_id.email }} • {{ cause.created_at|timesince }} ago
                <span class="status-badge status-{{ cause.status }}">{{ cause.status }}</span>
            </div>
        </div>
        {% empty %}
        <p>No recent causes</p>
        {% endfor %}
    </div>
    
    <div class="activity-section">
        <h3>Recent Users</h3>
        {% for user in recent_users %}
        <div class="activity-item">
            <div class="title">{{ user.first_name }} {{ user.last_name }}</div>
            <div class="meta">
                {{ user.email }} • {{ user.date_joined|timesince }} ago
                <span class="status-badge status-{{ user.is_active|yesno:'active,inactive' }}">
                    {{ user.is_active|yesno:'Active,Inactive' }}
                </span>
            </div>
        </div>
        {% empty %}
        <p>No recent users</p>
        {% endfor %}
    </div>
</div>

{{ block.super }}
{% endblock %}
