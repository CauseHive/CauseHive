import{q as W,r as o,j as e}from"./index-BOTlMoAj.js";function V(){const{data:n,updateProfile:u,updateUser:p,isLoading:w,isError:F}=W(),t=o.useMemo(()=>n?{id:n.profile.id,full_name:n.profile.full_name,bio:n.profile.bio??"",profile_picture:n.profile.profile_picture,phone_number:n.profile.phone_number??"",address:n.profile.address??"",updated_at:n.profile.updated_at,user_id:n.profile.user,email:n.user.email,first_name:n.user.first_name,last_name:n.user.last_name,withdrawal_address:n.profile.withdrawal_address}:null,[n]),[P,b]=o.useState(""),[M,h]=o.useState(""),[E,f]=o.useState(""),[B,v]=o.useState(""),[q,j]=o.useState(""),[a,g]=o.useState(null);o.useEffect(()=>{t&&(b(t.first_name||""),h(t.last_name||""),f(t.bio||""),v(t.phone_number||""),j(t.address||""),g(t.withdrawal_address||{payment_method:"bank_transfer"}))},[t]);const[L,_]=o.useState({});function r(s,l){_(d=>({...d,[s]:l})),l==="saved"&&setTimeout(()=>_(d=>d[s]==="saved"?{...d,[s]:"idle"}:d),1800)}function N(s,l=600){let d;return(...x)=>{clearTimeout(d),d=setTimeout(()=>s(...x),l)}}const y=o.useMemo(()=>N((s,l)=>{p.mutate(s,{onSuccess:()=>r(l,"saved"),onError:()=>r(l,"idle")})},650),[p]),U=o.useMemo(()=>N((s,l)=>{u.mutate(s,{onSuccess:()=>r(l,"saved"),onError:()=>r(l,"idle")})},650),[u]),k=o.useRef(null),[D,R]=o.useState(null),T=s=>{var S;const l=(S=s.target.files)==null?void 0:S[0];if(!l)return;const d=URL.createObjectURL(l);R(d);const x=new FormData;x.append("profile_picture",l),r("profile_picture","saving"),u.mutate(x,{onSuccess:()=>r("profile_picture","saved"),onError:()=>r("profile_picture","idle")})};if(w)return e.jsx("div",{children:"Loading profile…"});if(F||!t)return e.jsx("div",{className:"text-red-600",children:"Failed to load profile."});function i(s,l){if(!a)return;const d={...a,[s]:l};g(d),r("withdrawal_address","saving"),U({withdrawal_address:d},"withdrawal_address")}const m=(a==null?void 0:a.payment_method)||"bank_transfer",C=(m==="mobile_money"?["phone_number","provider","country"]:["bank_code","account_number","account_name"]).filter(s=>!a||!a[s]),A=C.length===0,c=s=>{const l=L[s];return l==="saving"?e.jsx("span",{className:"ml-2 text-[10px] text-amber-600",children:"Saving…"}):l==="saved"?e.jsx("span",{className:"ml-2 text-[10px] text-emerald-600",children:"Saved"}):null};return e.jsxs("div",{className:"max-w-3xl space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:D||t.profile_picture||"/profile_pictures/default.jpg",alt:t.full_name,className:"h-24 w-24 rounded-full object-cover border border-slate-200 dark:border-slate-700"}),e.jsx("button",{type:"button",onClick:()=>{var s;return(s=k.current)==null?void 0:s.click()},className:"absolute bottom-1 right-1 rounded bg-emerald-600 text-white text-xs px-2 py-1 shadow",children:"Change"}),e.jsx("input",{ref:k,type:"file",accept:"image/*",hidden:!0,onChange:T}),c("profile_picture")]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"My Profile"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Manage your personal information and avatar."})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Details"}),e.jsx("label",{className:"block text-xs mb-1",htmlFor:"full_name",children:"Full name"}),e.jsx("input",{id:"full_name",value:t.full_name,readOnly:!0,className:"w-full rounded-md border px-3 py-2 bg-slate-100 dark:bg-slate-900/40 cursor-not-allowed"}),e.jsx("label",{className:"block text-xs mb-1 mt-3",htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",defaultValue:t.email||"",readOnly:!0,className:"w-full rounded-md border px-3 py-2 bg-slate-50 dark:bg-slate-900/40"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs mb-1",htmlFor:"first_name",children:["First name ",c("first_name")]}),e.jsx("input",{id:"first_name",value:P,onChange:s=>{b(s.target.value),r("first_name","saving"),y({first_name:s.target.value},"first_name")},className:"w-full rounded-md border px-3 py-2"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs mb-1",htmlFor:"last_name",children:["Last name ",c("last_name")]}),e.jsx("input",{id:"last_name",value:M,onChange:s=>{h(s.target.value),r("last_name","saving"),y({last_name:s.target.value},"last_name")},className:"w-full rounded-md border px-3 py-2"})]})]}),e.jsxs("label",{className:"block text-xs mb-1",htmlFor:"phone_number",children:["Phone ",c("phone_number")]}),e.jsx("input",{id:"phone_number",value:B,onChange:s=>v(s.target.value),onBlur:s=>{r("phone_number","saving"),u.mutate({phone_number:s.target.value},{onSuccess:()=>r("phone_number","saved"),onError:()=>r("phone_number","idle")})},className:"w-full rounded-md border px-3 py-2"}),e.jsxs("label",{className:"block text-xs mb-1",htmlFor:"address",children:["Address ",c("address")]}),e.jsx("input",{id:"address",value:q,onChange:s=>j(s.target.value),onBlur:s=>{r("address","saving"),u.mutate({address:s.target.value},{onSuccess:()=>r("address","saved"),onError:()=>r("address","idle")})},className:"w-full rounded-md border px-3 py-2"}),e.jsxs("div",{className:"mt-4 text-[11px] text-slate-500 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Profile ID:"})," ",t.id]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"User ID:"})," ",t.user_id]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Updated:"})," ",t.updated_at?new Date(t.updated_at).toLocaleString():"—"]})]})]}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[e.jsxs("h2",{className:"font-medium mb-2",children:["Bio ",c("bio")]}),e.jsx("textarea",{value:E,onChange:s=>f(s.target.value),onBlur:s=>{r("bio","saving"),u.mutate({bio:s.target.value},{onSuccess:()=>r("bio","saved"),onError:()=>r("bio","idle")})},className:"w-full h-40 resize-none rounded-md border px-3 py-2",placeholder:"Tell supporters about yourself"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Changes auto-save on blur."})]}),e.jsxs("div",{className:"space-y-4 rounded-lg border p-4 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-medium",children:"Withdrawal Info"})," ",c("withdrawal_address")]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Method"}),e.jsxs("select",{className:"w-full rounded-md border px-2 py-2",value:m,onChange:s=>i("payment_method",s.target.value),children:[e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"})]})]}),m==="bank_transfer"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Bank Code"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-2",value:(a==null?void 0:a.bank_code)||"",onChange:s=>i("bank_code",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Account Number"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-2",value:(a==null?void 0:a.account_number)||"",onChange:s=>i("account_number",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Account Name"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-2",value:(a==null?void 0:a.account_name)||"",onChange:s=>i("account_name",s.target.value)})]})]}),m==="mobile_money"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Phone Number"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-2",value:(a==null?void 0:a.phone_number)||"",onChange:s=>i("phone_number",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Provider"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-2",value:(a==null?void 0:a.provider)||"",onChange:s=>i("provider",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1",children:"Country"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-2",value:(a==null?void 0:a.country)||"",onChange:s=>i("country",s.target.value)})]})]})]}),e.jsx("div",{className:"text-xs mt-2",children:A?e.jsx("span",{className:"text-emerald-600 font-medium",children:"Withdrawal info complete"}):e.jsxs("span",{className:"text-amber-600",children:["Missing: ",C.join(", ")]})})]})]})]})}export{V as ProfilePage};
