import{a as T,w as E,s as L,r as g,u as M,j as s,L as R,d as B}from"./index-BOTlMoAj.js";import{u as C,t as I,o as U,s as b}from"./zod-CKyyCNA0.js";import{B as $}from"./button-BQgy-EYF.js";import{I as v}from"./input-DCYKmd-d.js";import{L as N}from"./label-DKVCDqKQ.js";const q=U({password:b().min(8),confirm_password:b().min(8)}).refine(a=>a.password===a.confirm_password,{path:["confirm_password"],message:"Passwords do not match"});function H(){const[a]=T(),n=a.get("token")||"",S=a.get("uid")||"",d=E(),o=d.token||n,i=d.uid||S,_=L(),[m,c]=g.useState(null),[p,l]=g.useState(null),{register:w,handleSubmit:k,formState:{errors:e,isSubmitting:y}}=C({resolver:I(q)}),{notify:u}=M(),P=async F=>{var x,f,h,j;c(null),l(null);try{if(!i||!o)throw new Error("Missing token");const{data:t}=await B.post(`/user/password-reset/confirm/${i}/${o}/`,{password:F.password});l((t==null?void 0:t.message)??"Password updated"),u({title:"Password updated",variant:"success"}),setTimeout(()=>_("/login"),1200)}catch(t){const r=t;c(((f=(x=r==null?void 0:r.response)==null?void 0:x.data)==null?void 0:f.error)||"Failed to reset password"),u({title:"Failed to reset password",description:(j=(h=r==null?void 0:r.response)==null?void 0:h.data)==null?void 0:j.error,variant:"error"})}};return s.jsxs("div",{className:"max-w-md mx-auto",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Set a new password"}),p&&s.jsx("div",{className:"mb-3 text-emerald-700 text-sm",children:p}),m&&s.jsx("div",{className:"mb-3 text-red-600 text-sm",children:m}),(!o||!i)&&s.jsxs("div",{className:"mb-3 text-amber-700 text-sm",children:["Missing token. Request a new link ",s.jsx(R,{className:"underline",to:"/password-reset",children:"here"}),"."]}),s.jsxs("form",{onSubmit:k(P),className:"space-y-4",noValidate:!0,children:[s.jsxs("div",{children:[s.jsx(N,{htmlFor:"password",children:"New password"}),s.jsx(v,{id:"password",type:"password",...w("password"),"aria-invalid":!!e.password}),e.password&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:e.password.message})]}),s.jsxs("div",{children:[s.jsx(N,{htmlFor:"confirm_password",children:"Confirm password"}),s.jsx(v,{id:"confirm_password",type:"password",...w("confirm_password"),"aria-invalid":!!e.confirm_password}),e.confirm_password&&s.jsx("p",{className:"text-xs text-red-600 mt-1",children:e.confirm_password.message})]}),s.jsx($,{disabled:y||!n,className:"w-full",children:"Update password"})]})]})}export{H as PasswordResetConfirmPage};
