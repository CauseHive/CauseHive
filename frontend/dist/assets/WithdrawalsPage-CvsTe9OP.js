import{u as C,y as q,a as F,r as t,b as T,d as b,x as B,j as e}from"./index-BOTlMoAj.js";import{B as E}from"./button-BQgy-EYF.js";import{I as o}from"./input-DCYKmd-d.js";import{P as R}from"./pagination-ClcPKFUW.js";import{S as y}from"./skeleton-B4YvRN7w.js";import{E as W}from"./empty-CguYNUJV.js";function V(){const{notify:m}=C(),w=q(),[i,u]=F(),n=Number(i.get("page")??"1"),[d,f]=t.useState(100),[l,_]=t.useState("bank_transfer"),[h,S]=t.useState(""),[x,P]=t.useState(""),[p,M]=t.useState(""),[g,A]=t.useState(""),[j,k]=t.useState("MTN"),{data:a,isLoading:v}=T({queryKey:["withdrawals",{page:n}],queryFn:async()=>{const{data:s}=await b.get("/withdrawals/",{params:{page:n,ordering:"-created_at"}});return s}}),c=B({mutationFn:async()=>{const s=l==="bank_transfer"?{amount:d,withdrawal_method:l,account_details:{bank_code:x,account_number:h,account_name:p}}:{amount:d,withdrawal_method:l,account_details:{phone_number:g,provider:j}},{data:r}=await b.post("/withdrawals/request/",s);return r},onSuccess:()=>{m({title:"Withdrawal requested",variant:"success"}),w.invalidateQueries({queryKey:["withdrawals"]})},onError:s=>{var r,N;return m({title:"Withdrawal failed",description:(N=(r=s.response)==null?void 0:r.data)==null?void 0:N.error,variant:"error"})}});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Withdrawals"}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-3 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[e.jsxs("label",{className:"text-sm",children:["Amount (GHS)",e.jsx(o,{type:"number",min:1,value:d,onChange:s=>f(Number(s.target.value))})]}),e.jsxs("label",{className:"text-sm",children:["Method",e.jsxs("select",{className:"w-full rounded-md border bg-transparent p-2",value:l,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"bank_transfer",children:"Bank transfer"}),e.jsx("option",{value:"mobile_money",children:"Mobile money"})]})]}),l==="bank_transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-sm",children:["Bank code",e.jsx(o,{value:x,onChange:s=>P(s.target.value)})]}),e.jsxs("label",{className:"text-sm",children:["Account number",e.jsx(o,{value:h,onChange:s=>S(s.target.value)})]}),e.jsxs("label",{className:"text-sm sm:col-span-2",children:["Account name",e.jsx(o,{value:p,onChange:s=>M(s.target.value)})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-sm",children:["Phone number",e.jsx(o,{value:g,onChange:s=>A(s.target.value)})]}),e.jsxs("label",{className:"text-sm",children:["Provider",e.jsxs("select",{className:"w-full rounded-md border bg-transparent p-2",value:j,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"MTN",children:"MTN"}),e.jsx("option",{value:"Vodafone",children:"Vodafone"}),e.jsx("option",{value:"AirtelTigo",children:"AirtelTigo"})]})]})]})]}),e.jsx(E,{onClick:()=>c.mutate(),disabled:c.isPending,children:c.isPending?"Submitting…":"Request withdrawal"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-medium",children:"History"}),v&&e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,r)=>e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx(y,{className:"h-4 w-48"}),e.jsx(y,{className:"h-3 w-64 mt-2"})]},r))}),e.jsxs("div",{className:"rounded-lg border divide-y",children:[a&&Array.isArray(a.results)&&a.results.length===0&&!v&&e.jsx("div",{className:"p-4",children:e.jsx(W,{title:"No withdrawals yet",description:"Your withdrawal requests will show up here."})}),Array.isArray(a==null?void 0:a.results)&&(a==null?void 0:a.results.map(s=>e.jsxs("div",{className:"p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:["₵",s.amount.toFixed(2)," ",e.jsx("span",{className:"ml-2 text-xs uppercase text-slate-500",children:s.withdrawal_method.replace("_"," ")})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Requested ",new Date(s.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-medium ${s.status==="completed"?"text-emerald-600":s.status==="pending"?"text-amber-600":"text-red-600"}`,children:s.status}),typeof s.net_amount=="number"&&e.jsxs("div",{className:"text-xs text-slate-500",children:["Net ₵",s.net_amount.toFixed(2)]})]})]},s.id)))]}),a&&e.jsx(R,{page:n,hasPrev:!!a.previous,hasNext:!!a.next,onPrev:()=>{const s=new URLSearchParams(i);s.set("page",String(Math.max(1,n-1))),u(s)},onNext:()=>{const s=new URLSearchParams(i);s.set("page",String(n+1)),u(s)}})]})]})}export{V as WithdrawalsPage,V as default};
