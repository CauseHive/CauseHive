import{w,s as y,r as b,u as v,b as _,d as l,x,j as a}from"./index-BOTlMoAj.js";import{B as h}from"./button-BQgy-EYF.js";import{I as k}from"./input-DCYKmd-d.js";import{S as i}from"./skeleton-B4YvRN7w.js";function F(){const{id:n}=w(),p=y(),[o,j]=b.useState(50),{notify:d}=v(),{data:t,isLoading:N,isError:f}=_({queryKey:["cause",n],queryFn:async()=>{const{data:e}=await l.get(`/causes/${n}/`);return e}}),c=x({mutationFn:async()=>{var r;const{data:e}=await l.post("/donations/",{cause_id:n,amount:o}),{data:s}=await l.post("/payments/initialize/",{donation_id:e.id,amount:o,email:(r=e.donor)==null?void 0:r.email,callback_url:window.location.origin+"/payment/callback"});return s},onSuccess:e=>{const s=e.data.authorization_url;window.location.href=s},onError:e=>{var r,u,g;const s=e;d({title:"Payment init failed",description:((u=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:u.error)||"Try again",variant:"error"}),(g=s==null?void 0:s.response)!=null&&g.status||p("/login")}}),m=x({mutationFn:async()=>{let e;try{const{data:s}=await l.get("/cart/");typeof(s==null?void 0:s.cart_id)=="string"&&(e=s.cart_id)}catch{}await l.post("/cart/add/",{cause_id:n,amount:o,...e?{cart_id:e}:{}})},onSuccess:()=>d({title:"Added to cart",variant:"success"}),onError:()=>d({title:"Failed to add to cart",variant:"error"})});return N?a.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"md:col-span-2 space-y-4",children:[a.jsx(i,{className:"h-64 w-full"}),a.jsx(i,{className:"h-8 w-2/3"}),a.jsx(i,{className:"h-24 w-full"})]}),a.jsxs("aside",{className:"space-y-4",children:[a.jsxs("div",{className:"rounded-lg border p-4",children:[a.jsx(i,{className:"h-6 w-1/3"}),a.jsx(i,{className:"h-4 w-1/2 mt-2"})]}),a.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[a.jsx(i,{className:"h-4 w-2/5"}),a.jsx(i,{className:"h-10 w-full"}),a.jsx(i,{className:"h-10 w-full"}),a.jsx(i,{className:"h-10 w-full"})]})]})]}):f||!t?a.jsx("div",{className:"text-red-600",children:"Could not load cause."}):a.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"md:col-span-2 space-y-4",children:[t.featured_image&&a.jsx("img",{src:t.featured_image,alt:t.title?`Image for ${t.title}`:"Cause image",className:"w-full rounded-lg"}),a.jsx("h1",{className:"text-2xl font-semibold",children:t.title}),a.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-line",children:t.description})]}),a.jsxs("aside",{className:"space-y-4",children:[a.jsxs("div",{className:"rounded-lg border p-4 bg-white dark:bg-slate-900",children:[a.jsx("div",{className:"text-sm text-slate-500",children:"Progress"}),a.jsxs("div",{className:"text-lg font-medium",children:["₵",t.current_amount.toLocaleString()," / ₵",t.target_amount.toLocaleString()]}),a.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden mt-2","aria-label":`Progress ${Math.round(t.progress_percentage)}%`,children:a.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${t.progress_percentage}%`}})})]}),a.jsxs("div",{className:"rounded-lg border p-4 bg-white dark:bg-slate-900 space-y-3",children:[a.jsx("label",{className:"block text-sm",htmlFor:"amount",children:"Donation Amount (GHS)"}),a.jsx(k,{id:"amount",type:"number",min:1,value:o,onChange:e=>j(Number(e.target.value))}),a.jsx(h,{onClick:()=>c.mutate(),disabled:c.isPending,className:"w-full",children:c.isPending?"Processing…":"Donate Now"}),a.jsx(h,{onClick:()=>m.mutate(),disabled:m.isPending,className:"w-full",variant:"outline",children:"Add to Cart"})]})]})]})}export{F as CauseDetailsPage};
