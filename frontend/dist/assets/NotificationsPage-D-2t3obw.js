import{u as j,y as v,a as N,b as k,d,r as w,x as f,j as e}from"./index-BOTlMoAj.js";import{S as g}from"./skeleton-B4YvRN7w.js";import{B as y}from"./button-BQgy-EYF.js";import{B as b}from"./badge-Dnd58h3w.js";import{P}from"./pagination-ClcPKFUW.js";import{E as S}from"./empty-CguYNUJV.js";function K(){const{notify:n}=j(),o=v(),[t,c]=N(),r=Number(t.get("page")??"1"),l=t.get("unread_only")==="true",m=t.get("type")||"",{data:s,isLoading:u,isError:x}=k({queryKey:["notifications",{page:r,unreadOnly:l,type:m}],queryFn:async()=>{const{data:a}=await d.get("/notifications/",{params:{page:r,unread_only:l||void 0,type:m||void 0,ordering:"-created_at"}});return a}});w.useEffect(()=>{x&&n({title:"Failed to load notifications",variant:"error"})},[x,n]);const p=f({mutationFn:async a=>{await d.patch(`/notifications/${a}/read/`)},onSuccess:()=>{o.invalidateQueries({queryKey:["notifications"]}),o.invalidateQueries({queryKey:["notifications-unread-count"]})}}),h=f({mutationFn:async()=>{await d.post("/notifications/mark-all-read/")},onSuccess:()=>{o.invalidateQueries({queryKey:["notifications"]}),o.invalidateQueries({queryKey:["notifications-unread-count"]}),n({title:"All notifications marked as read",variant:"success"})},onError:()=>n({title:"Failed to mark all as read",variant:"error"})});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Notifications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-sm flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:a=>{const i=new URLSearchParams(t);a.target.checked?i.set("unread_only","true"):i.delete("unread_only"),i.set("page","1"),c(i)}}),"Unread only"]}),e.jsx(y,{variant:"outline",onClick:()=>h.mutate(),disabled:h.isPending,children:"Mark all read"})]})]}),u&&e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((a,i)=>e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx(g,{className:"h-4 w-48"}),e.jsx(g,{className:"h-3 w-64 mt-2"})]},i))}),e.jsxs("div",{className:"space-y-3",children:[s&&s.results.length===0&&!u&&e.jsx(S,{title:"No notifications",description:"You're all caught up."}),s==null?void 0:s.results.map(a=>e.jsx("div",{className:"rounded-lg border p-4 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium",children:a.title}),!a.is_read&&e.jsx(b,{variant:"warning",children:"new"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mt-1",children:a.message}),e.jsx("div",{className:"text-xs text-slate-500 mt-2",children:new Date(a.created_at).toLocaleString()})]}),e.jsx("div",{className:"flex items-center gap-2",children:!a.is_read&&e.jsx(y,{size:"sm",onClick:()=>p.mutate(a.id),disabled:p.isPending,children:"Mark read"})})]})},a.id))]}),s&&e.jsx(P,{page:r,hasPrev:!!s.previous,hasNext:!!s.next,onPrev:()=>{const a=new URLSearchParams(t);a.set("page",String(Math.max(1,r-1))),c(a)},onNext:()=>{const a=new URLSearchParams(t);a.set("page",String(r+1)),c(a)}})]})}export{K as NotificationsPage,K as default};
