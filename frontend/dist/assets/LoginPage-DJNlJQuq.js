import{s as k,r as x,u as E,t as T,b as F,d as h,j as e,L as f,v as U}from"./index-BOTlMoAj.js";import{u as C,t as G,o as q,s as j}from"./zod-CKyyCNA0.js";import{B as w}from"./button-BQgy-EYF.js";import{I as y}from"./input-DCYKmd-d.js";import{L as b}from"./label-DKVCDqKQ.js";const A=q({email:j().email(),password:j().min(8)});function D(){const l=k(),[c,m]=x.useState(null),{notify:d}=E(),{register:u,handleSubmit:v,formState:{errors:a,isSubmitting:g}}=C({resolver:G(A)});x.useEffect(()=>{T.getAccessToken()&&l("/app",{replace:!0})},[l]);const N=async r=>{var o,i;m(null);try{const{data:s}=await h.post("/user/auth/login/",r);U({access:s.access,refresh:s.refresh,user:s.user,navigate:l,notify:d,welcomeTitle:"Welcome back"})}catch(s){const t=s,p=((i=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:i.error)||"Login failed";m(p),d({title:"Login failed",description:p,variant:"error"})}},{data:n,error:S,isLoading:L}=F({queryKey:["google-oauth-url"],queryFn:async()=>{const{data:r}=await h.get("/user/google/url/"),o=r,i=["google_oauth_url","url","googleUrl"];for(const s of i){const t=o[s];if(typeof t=="string"&&t.startsWith("http"))return t}return""},placeholderData:""});return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Sign in"}),c&&e.jsx("div",{className:"mb-4 text-red-600 text-sm",role:"alert",children:c}),S&&e.jsx("div",{className:"mb-4 text-amber-700 text-sm",role:"alert",children:"Google sign-in isn’t available right now. Try email/password, or contact the admin to configure Google OAuth."}),e.jsxs("form",{onSubmit:v(N),className:"space-y-4",noValidate:!0,children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"email",children:"Email"}),e.jsx(y,{id:"email",type:"email",...u("email"),"aria-invalid":!!a.email}),a.email&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:a.email.message})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"password",children:"Password"}),e.jsx(y,{id:"password",type:"password",...u("password"),"aria-invalid":!!a.password}),a.password&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:a.password.message})]}),e.jsx(w,{disabled:g,className:"w-full",children:g?"Signing in…":"Sign in"})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>{n&&(window.location.href=n)},className:"w-full",disabled:L||!n,children:"Continue with Google"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx(f,{to:"/signup",className:"text-emerald-700",children:"Create account"}),e.jsx(f,{to:"/password-reset",className:"text-slate-600",children:"Forgot password?"})]})]})]})}export{D as LoginPage};
