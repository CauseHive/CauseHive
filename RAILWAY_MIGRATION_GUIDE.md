#!/bin/bash

# CauseHive Backend Migration Script for Railway
# Run this to update your Railway deployment with the new API endpoints

echo "üöÄ CauseHive Backend Migration for Railway"
echo "==========================================="
echo ""

echo "üìù Summary of changes made:"
echo "  ‚úÖ Fixed /api/donations/ 500 error (now returns public donations)"
echo "  ‚úÖ Added missing API endpoints:"
echo "     - /api/blog-posts/"
echo "     - /api/testimonials/"
echo "     - /api/contributors/"
echo "     - /api/statistics/"
echo "     - /api/newsletter/subscribe/"
echo "  ‚úÖ Fixed causes API organizer validation issue"
echo "  ‚úÖ Added pagination support"
echo ""

echo "üîß Steps to deploy to Railway:"
echo ""
echo "1. Navigate to your backend directory:"
echo "   cd backend/monolithic_app"
echo ""
echo "2. Install Railway CLI if not already installed:"
echo "   npm install -g @railway/cli"
echo ""
echo "3. Login to Railway:"
echo "   railway login"
echo ""
echo "4. Create migrations for new apps:"
echo "   python manage.py makemigrations blog"
echo "   python manage.py makemigrations newsletter"
echo ""
echo "5. Deploy the updated code:"
echo "   railway up"
echo ""
echo "6. Apply migrations on Railway:"
echo "   railway shell"
echo "   # Then inside the Railway shell:"
echo "   python manage.py migrate"
echo "   exit"
echo ""
echo "üîç To monitor deployment:"
echo "   railway logs --tail"
echo ""
echo "üåê Your API endpoints will be available at:"
echo "   https://causehive-monolithic-production.up.railway.app/api/"
echo ""
echo "‚ö° Quick test after deployment:"
echo "   curl https://causehive-monolithic-production.up.railway.app/api/causes/list/"
echo "   curl https://causehive-monolithic-production.up.railway.app/api/donations/"
echo "   curl https://causehive-monolithic-production.up.railway.app/api/blog-posts/"
echo ""
echo "üö® If you see 500 errors, check Railway logs:"
echo "   railway logs"
echo ""
echo "üí° Common issues to check:"
echo "   - Environment variables are set correctly"
echo "   - Database migrations completed successfully"
echo "   - All dependencies in requirements.txt are installed"
